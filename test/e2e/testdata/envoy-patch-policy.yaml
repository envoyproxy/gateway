---
apiVersion: gateway.networking.k8s.io/v1beta1
kind: HTTPRoute
metadata:
  name: http-envoy-patch-policy 
  namespace: gateway-conformance-infra
spec:
  parentRefs:
  - name: same-namespace
  rules:
  - backendRefs:
    - name: infra-backend-v1
      port: 8080
    matches:
    - path:
        type: PathPrefix
        value: /foo
---
apiVersion: gateway.envoyproxy.io/v1alpha1
 kind: EnvoyPatchPolicy
 metadata:
   name: custom-response-patch-policy
   namespace: default
 spec:
   targetRef:
     group: gateway.networking.k8s.io
     kind: Gateway
     name: same-namespace
     namespace: gateway-conformance-infra 
   type: JSONPatch
   jsonPatches:
     - type: "type.googleapis.com/envoy.config.listener.v3.Listener"
       # The listener name is of the form <GatewayNamespace>/<GatewayName>/<GatewayListenerName>
       name: gateway-conformance-infra/same-namespace/http
       operation:
         op: add
         path: "/default_filter_chain/filters/0/typed_config"
         value:
           local_reply_config:
             mappers:
             - filter:
                 status_code_filter:
                   comparison:
                    op: EQ
                    value:
                      default_value: 404
                      runtime_key: key_b
               status_code: 418
               body:
                 inline_string: "im a teapot"
