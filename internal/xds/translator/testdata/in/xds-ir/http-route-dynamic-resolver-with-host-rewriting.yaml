http:
  - address: 0.0.0.0
    externalPort: 80
    hostnames:
      - '*'
    metadata:
      kind: Gateway
      name: gateway-1
      namespace: envoy-gateway
      sectionName: http
    name: envoy-gateway/gateway-1/http
    path:
      escapedSlashesAction: UnescapeAndRedirect
      mergeSlashes: true
    port: 10080
    routes:
      # test DynamicResolver backend with host rewriting filter with default DNS cache config, rewrite from header x-dynamic-host-header-1
      - destination:
          metadata:
            kind: HTTPRoute
            name: httproute-1
            namespace: default
          name: httproute/default/httproute-1/rule/0
          settings:
            - isDynamicResolver: true
              name: httproute/default/httproute-1/rule/0/backend/0
              protocol: HTTP
              weight: 1
        hostname: gateway.envoyproxy.io
        isHTTP2: false
        metadata:
          kind: HTTPRoute
          name: httproute-1
          namespace: default
        name: httproute/default/httproute-1/rule/0/match/0/gateway_envoyproxy_io
        pathMatch:
          distinct: false
          name: ""
          prefix: /foo
        urlRewrite:
          host:
            header: x-dynamic-host-header-1
      # test DynamicResolver backend with host rewriting filter with default DNS cache config, rewrite from header x-dynamic-host-header-2
      - destination:
          metadata:
            kind: HTTPRoute
            name: httproute-1
            namespace: default
          name: httproute/default/httproute-1/rule/1
          settings:
            - isDynamicResolver: true
              name: httproute/default/httproute-1/rule/1/backend/0
              protocol: HTTP
              tls:
                alpnProtocols: null
                caCertificate:
                  name: backend-with-system-ca/default-ca
                useSystemTrustStore: true
              weight: 1
        hostname: gateway.envoyproxy.io
        isHTTP2: false
        metadata:
          kind: HTTPRoute
          name: httproute-1
          namespace: default
        name: httproute/default/httproute-1/rule/1/match/0/gateway_envoyproxy_io
        pathMatch:
          distinct: false
          name: ""
          prefix: /bar
        urlRewrite:
          host:
            header: x-dynamic-host-header-2
      # test DynamicResolver backend with host rewriting filter with custom DNS cache config
      - destination:
          metadata:
            kind: HTTPRoute
            name: httproute-2
            namespace: default
          name: httproute/default/httproute-2/rule/0
          settings:
            - isDynamicResolver: true
              name: httproute/default/httproute-2/rule/0/backend/0
              protocol: HTTP
              weight: 1
        hostname: gateway.envoyproxy.io
        isHTTP2: false
        metadata:
          kind: HTTPRoute
          name: httproute-2
          namespace: default
        name: httproute/default/httproute-2/rule/0/match/0/gateway_envoyproxy_io
        pathMatch:
          distinct: false
          name: ""
          prefix: /baz
        traffic:
          dns:
            dnsRefreshRate: 1s
            lookupFamily: IPv4AndIPv6
            name: default/dns-policy-for-httproute-2
        urlRewrite:
          host:
            header: x-dynamic-host-header-3
        # test denying requests with forbiddena host rewrite header values
        security:
          authorization:
            defaultAction: Allow
            rules:
              - action: Deny
                name: disallow-forbidden-hosts
                principal:
                  headers:
                    - name: x-dynamic-host-header-3
                      values:
                        - forbidden.com
      # test DynamicResolver backend with host rewriting filter with custom DNS cache config, rewrite to literal name
      - destination:
          metadata:
            kind: HTTPRoute
            name: httproute-2
            namespace: default
          name: httproute/default/httproute-2/rule/1
          settings:
            - isDynamicResolver: true
              name: httproute/default/httproute-2/rule/1/backend/0
              protocol: HTTP
              weight: 1
        hostname: gateway.envoyproxy.io
        isHTTP2: false
        metadata:
          kind: HTTPRoute
          name: httproute-2
          namespace: default
        name: httproute/default/httproute-2/rule/1/match/0/gateway_envoyproxy_io
        pathMatch:
          distinct: false
          name: ""
          prefix: /qux
        traffic:
          dns:
            dnsRefreshRate: 1s
            lookupFamily: IPv4AndIPv6
            name: default/dns-policy-for-httproute-2
        urlRewrite:
          host:
            name: rewrite.com
