apiVersion: v1
kind: ConfigMap
metadata:
  name: envoy-gateway-config
  namespace: '{{ .Release.Namespace }}'
  labels:
  {{- include "eg.labels" . | nindent 4 }}
data:
  envoy-gateway.yaml: |
    apiVersion: config.gateway.envoyproxy.io/v1alpha1
    gateway:
      controllerName: {{ .Values.config.envoyGateway.gateway.controllerName
        | quote }}
    kind: EnvoyGateway
    provider:
      type: {{ .Values.config.envoyGateway.provider.type | quote }}
      kubernetes:
        rateLimitDeployment:
          replicas: 1
          container:
            image: envoyproxy/ratelimit:master
            resources:
              requests:
                cpu: 200m
                memory: 512Mi
            securityContext:
              runAsUser: 2000
              allowPrivilegeEscalation: false
          pod:
            securityContext:
              runAsUser: 1000
              runAsGroup: 3000
              fsGroup: 2000
              fsGroupChangePolicy: "OnRootMismatch"
    rateLimit:
      backend:
        type: Redis
        redis:
          url: redis.redis-system.svc.cluster.local:6379
