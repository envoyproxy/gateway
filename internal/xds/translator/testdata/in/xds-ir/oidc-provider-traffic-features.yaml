http:
# Test HTTPListener with SecurityPolicy using OIDC provider with traffic features configured, but without Destination.
- address: 0.0.0.0
  externalPort: 80
  hostnames:
  - '*'
  isHTTP2: false
  metadata:
    kind: Gateway
    name: gateway-1
    namespace: envoy-gateway
    sectionName: http
  name: envoy-gateway/gateway-1/http
  path:
    escapedSlashesAction: UnescapeAndRedirect
    mergeSlashes: true
  port: 10080
  routes:
  - destination:
      metadata:
        kind: HTTPRoute
        name: httproute-1
        namespace: default
      name: httproute/default/httproute-1/rule/0
      settings:
      - addressType: IP
        endpoints:
        - host: 7.7.7.7
          port: 8080
        metadata:
          kind: Service
          name: service-1
          namespace: default
          sectionName: "8080"
        name: httproute/default/httproute-1/rule/0/backend/0
        protocol: HTTP
        weight: 1
    hostname: www.example.com
    isHTTP2: false
    metadata:
      kind: HTTPRoute
      name: httproute-1
      namespace: default
    name: httproute/default/httproute-1/rule/0/match/0/www_example_com
    pathMatch:
      distinct: false
      name: ""
      prefix: /foo
    security:
      oidc:
        clientID: client1.apps.googleusercontent.com
        clientSecret: '[redacted]'
        cookieSuffix: b0a1b740
        defaultRefreshTokenTTL: 24h0m0s
        defaultTokenTTL: 30m0s
        forwardAccessToken: true
        hmacSecret: '[redacted]'
        logoutPath: /bar/logout
        name: securitypolicy/envoy-gateway/policy-for-gateway
        provider:
          authorizationEndpoint: https://oauth.foo.com/oauth2/v2/auth
          tokenEndpoint: https://oauth.foo.com/token
          traffic:
            backendConnection:
              bufferLimit: 100000000
            circuitBreaker:
              maxConnections: 2048
              maxParallelRequests: 4294967295
              maxParallelRetries: 1024
              maxPendingRequests: 1
              maxRequestsPerConnection: 1
            dns:
              dnsRefreshRate: 30s
              lookupFamily: IPv4AndIPv6
            healthCheck:
              active:
                healthyThreshold: 1
                http:
                  expectedResponse:
                    binary: RXZlcnl0aGluZyBPSw==
                  expectedStatuses:
                  - 200
                  - 300
                  host: ""
                  method: GET
                  path: /healthz
                interval: 3s
                timeout: 500ms
                unhealthyThreshold: 3
              passive:
                baseEjectionTime: 2m40s
                consecutive5XxErrors: 5
                consecutiveGatewayErrors: 0
                consecutiveLocalOriginFailures: 5
                interval: 2s
                maxEjectionPercent: 100
                splitExternalLocalOriginErrors: false
            loadBalancer:
              consistentHash:
                sourceIP: true
            retry:
              numRetries: 3
              perRetry:
                backOff:
                  baseInterval: 1s
                  maxInterval: 5s
              retryOn:
                triggers:
                - 5xx
                - gateway-error
                - reset
            tcpKeepalive:
              idleTime: 1200
              interval: 60
              probes: 3
            timeout:
              http:
                connectionIdleTimeout: 16s
                maxConnectionDuration: 17s
                requestTimeout: 5s
              tcp:
                connectTimeout: 15s
        redirectPath: /bar/oauth2/callback
        redirectURL: https://www.example.com/bar/oauth2/callback
        refreshToken: true
        scopes:
        - openid
