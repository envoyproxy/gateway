# ./certs/client-mtls-trustbundle.sh
#
# kubectl create secret generic example-com-tls -n gateway-conformance-infra --from-file=ca.crt=example.com.crt --from-file=tls.crt=www.example.com.crt --from-file=tls.key=www.example.com.key --dry-run=client -o yaml > example-com-tls.yaml
apiVersion: v1
data:
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURWVENDQWoyZ0F3SUJBZ0lVVCtlWHNsNDIrWnoyNzVZaVBjTWUvQnBuajJ3d0RRWUpLb1pJaHZjTkFRRUwKQlFBd0xURVZNQk1HQTFVRUNnd01aWGhoYlhCc1pTQkpibU11TVJRd0VnWURWUVFEREF0bGVHRnRjR3hsTG1OdgpiVEFlRncweU5UQTJNVGt4TWpFNU5URmFGdzB5TmpBMk1Ua3hNakU1TlRGYU1DMHhGVEFUQmdOVkJBb01ER1Y0CllXMXdiR1VnU1c1akxqRVVNQklHQTFVRUF3d0xaWGhoYlhCc1pTNWpiMjB3Z2dFaU1BMEdDU3FHU0liM0RRRUIKQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUNQRWloRzZwbE5oU01nZkFYWmdQSDFzdjNWbklUV1hxbzRYd1I4SGVKRgpFYXVtVE1pcCtCM2djcXY4T3JNV2VORERWSzl3Q0lzVVpjNDIxcTFsRWRNWmdCNHBiQ1VMWUUzMkdjblh4TVNKCnVOUldYdU9JOTM5TkE4THJGb1dQV3BmNTUvcERhUTJKVFlDK1Jya05RcVhoa09rdlMvYTNuOEd3dDJnNjUzdUQKcUI4aWdtd0dESWliK2VBY0UxSnNMVldjaytHaG9wMkFyRjZoZFFDdXdBaHppSXR4RVhmQ3lJekhORXU0UXRtTQoybDRkd0xaYWdidjZqRkpvYTJ0cE9wYnFuQzNxZmZTRkN0RVVoMkRITXpVbUtsNGl3N0l4dWM1VWhHcVBFRWFLClZKUENnRSs3UXdHYWV3MzUxKzZtZFNVV1FtWDRIcWZMNllMMTNoR3FEOWtqQWdNQkFBR2piVEJyTUIwR0ExVWQKRGdRV0JCUWtKUDhZRVhVSUVrbmtsRGViNFNhQXlhYWIxVEFmQmdOVkhTTUVHREFXZ0JRa0pQOFlFWFVJRWtuawpsRGViNFNhQXlhYWIxVEFQQmdOVkhSTUJBZjhFQlRBREFRSC9NQmdHQTFVZEVRUVJNQStDRFNvdVpYaGhiWEJzClpTNWpiMjB3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUNDcVNvRkgrZ3Z4SUtmcmE4dURDV1pGdVVrVWhKbE8KNFZmblo1SVpsZHlZSWk3c2hHbWdyWDZCcEdFK1RNM1E0Mk5nditMZUF2OUpyaTZ3YXFlNVdDc09oRWY2clBXNQpCNVp6OUEwN28vQUFYZDVVd25WWTNuejFEcC9pcUJ3WUJPbzk1U2U1Mnd4WXM0Qk1pOVF2ZlNQVEcrMFp3T3hoCnpjRjVrb0VIL0MxcGJtTWtSMFlpRHBpM295c0FxRnBMTy80MXozQ2hjbzY3QWlMaEV1K0JDdytGeHN3NVR5dGgKRlZJeGxtSnZhUklqcHFzWVRwcmUvUGFKUjEva2dveVorR1BRWFl0aGN0bmhZM203M2hRYWtTVGtRYUVBakxTMApDZEdOczJxMzk3ZmJ6dWw2eEhWUjQwRFFBV3IzaCs5a2tJamhVR3VCVnljSE1BY0hXeXcxWUNFPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQwakNDQXJxZ0F3SUJBZ0lVTzdKTjJjSE56ZmV6elBhSHlpK2kyRU9pL1Jnd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0xURVZNQk1HQTFVRUNnd01aWGhoYlhCc1pTQkpibU11TVJRd0VnWURWUVFEREF0bGVHRnRjR3hsTG1OdgpiVEFlRncweU5UQTJNVGt4TWpFNU5URmFGdzB6TlRBMk1UY3hNakU1TlRGYU1Ea3hHREFXQmdOVkJBTU1EM2QzCmR5NWxlR0Z0Y0d4bExtTnZiVEVkTUJzR0ExVUVDZ3dVWlhoaGJYQnNaU0J2Y21kaGJtbDZZWFJwYjI0d2dnRWkKTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFEaGV3bEd3cFNpNFpwWVhuSjBDR0pvZFFLMwo4RlZ5NzEyWVNVaHZGN3NBRzFHcmlqbUZBWDJ3SkFUMnNpVkRlOTdPODRtbGRDWXIxdTducWVqa090MDVuOFpBCjVyNk9RZUJnWmtyS1lmcjRyODdDeU5TTmJEZ1VRa1lIN1Fac0FWM2lqSmpmWm1KVk9HbUlPMFJFYjM5WFFVT3gKQjJrblp2QVBrWVBwZ0owd0JPS2JmRnhBUkM3YktGei9DQVROcEQ1TUFRWmlEbFFyTVNXT0FYTVFMNHh6RDNhVApSTnRlVW11RmxsVzJIRGZyVzA2RGw0OFlUZmt2bFU3bGJINUhBQVY3ZkkvZFJyYmhPSXRFajNSR2lHaitCS1gxCkpZSXE4ZXFyQXFubnZzckFKcEw0bks2eWFVMC93bzYzd2NFUGFpUE9KZlNLN2U3d3FWUU50aVlVaE8rYkFnTUIKQUFHamdkMHdnZG93SFFZRFZSME9CQllFRkhDK1NRcDZ3eW9jeG53Yjk4UU1vQTA1TmtXZU1HZ0dBMVVkSXdSaApNRitBRkNRay94Z1JkUWdTU2VTVU41dmhKb0RKcHB2Vm9UR2tMekF0TVJVd0V3WURWUVFLREF4bGVHRnRjR3hsCklFbHVZeTR4RkRBU0JnTlZCQU1NQzJWNFlXMXdiR1V1WTI5dGdoUlA1NWV5WGpiNW5QYnZsaUk5d3g3OEdtZVAKYkRBTUJnTlZIUk1FQlRBREFRSC9NQXNHQTFVZER3UUVBd0lDL0RBYUJnTlZIUkVFRXpBUmdnOTNkM2N1WlhoaApiWEJzWlM1amIyMHdHQVlEVlIwU0JCRXdENElOS2k1bGVHRnRjR3hsTG1OdmJUQU5CZ2txaGtpRzl3MEJBUXNGCkFBT0NBUUVBZEFqaDVhbWFRQmJoRE5JQ2JqVHZ3Y0lWaFhnNTI1NkxKaGwvRHc1Zk9vNWdIT05wVUJwWVBQcUQKVjMwdmlNMXloNkthb2lRc3JXSHNoMFgvR3RYT1JwemhaajN3c0NVTEFpRmsvb2Vva2pYZnFKbm1DNlc0b08rTwpsMzFFQnNtVkxPcmRDZFJrOTJMZ0FYY0lsdE1VVjViV25mdDF1RTExWEJTclUrcWNoS3h6VStUZ29yK3g4Nk5jCnNzKzdzMXFzbUFLc01OUXJVQXJFY21NZCtrZDFqTWJoV3BNQ2VWMXJ3QTB6UDVJa0F6Ym1GVmVkMEtyOVRwazQKWWw3V21kSnlNNVd3bENSS1JRWW5sN3RCUzdIVmZDck9pRW1rTU9SVU9XUEJwVU5uc0ZPVWVWNUo1N0x0WEVzcApwdWV3UytmdG5aZm91ODUyYUp1Nzc5Qnh6THN0U2c9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRGhld2xHd3BTaTRacFkKWG5KMENHSm9kUUszOEZWeTcxMllTVWh2RjdzQUcxR3Jpam1GQVgyd0pBVDJzaVZEZTk3Tzg0bWxkQ1lyMXU3bgpxZWprT3QwNW44WkE1cjZPUWVCZ1prcktZZnI0cjg3Q3lOU05iRGdVUWtZSDdRWnNBVjNpakpqZlptSlZPR21JCk8wUkViMzlYUVVPeEIya25adkFQa1lQcGdKMHdCT0tiZkZ4QVJDN2JLRnovQ0FUTnBENU1BUVppRGxRck1TV08KQVhNUUw0eHpEM2FUUk50ZVVtdUZsbFcySERmclcwNkRsNDhZVGZrdmxVN2xiSDVIQUFWN2ZJL2RScmJoT0l0RQpqM1JHaUdqK0JLWDFKWUlxOGVxckFxbm52c3JBSnBMNG5LNnlhVTAvd282M3djRVBhaVBPSmZTSzdlN3dxVlFOCnRpWVVoTytiQWdNQkFBRUNnZ0VBVE9iNXN2aUtXVU00c1FzRlhpMjk0b0tGK3RZdFRwWDFCZ3Q0ZU90UERDcEYKSUl4ME1iamdkVUxUcm8venhhQnB6WXVpVnB2V3FQMFZYazNFOEpKakFWUk0rYlc1S0N1dnF6RTRNTzVaK3BkNwpuVk9CcXZwTjVocjBaNStmb1JhV1ByNVZKVngyRFRyQVE0WnpNaVFVK2wxNENOak9OSElYVGpnREZaQ1lDOWY2CnBSU2RJejZ3SjlqR1RsUzhuWHZnc053WHZ4TG1tZ2hpNFdKYWtqUlh5T0NFUkxlV1JzeThCU2pKY0YvYkpLdFIKVlpWT0JsL29Dd1l4TCtwZExBUkUzdDgyOVQyQ2h5S2pFM2htRXhZT2tEQjc5R21JcEN1QTJBVXgrVCtkbVQ5QQpta1ZHK29lNHlUQWdSK004cW41N3FNeWZ0U3hRdmFhRFQzQXA5eFU5QVFLQmdRRDdPeHlZQVVYMVpnR2kwc2JHCnh3V2xyMnRHSXFZcFdCMjh0d1R6RlVCaVI4MStrTml0bVpEN0E5N2c5RUpaSWtQbEhwMkhzeHlFeVlFRHRkcGkKdXhRb1ZlVWZRcmd4ZmIrZWdFZmtQUVJqVjFnRU9aRGIzOWNaT1hVVXJoMGtNY1R4dGtManQ3eE9RV3FsZ20wKwphcTlVcmtZOFMzTExSNExOdWVzMXFHL0NTUUtCZ1FEbHdzbW8yaEg1K25SeVFlOWpNencyUG01djJ6c0YxOW9XCmN0ODU3VFB6eG83M1psZFllL2lRdktzQzJxcWtwTHZtdWh5ZkxQV00xRHVOYzhwbURtRHpTTHFPbXc0b1BwUjYKaURtMXA3UmhraWxKS3NBZEVNaXFNQkJQRHVxQmNDNWo4ZFkwaUlhb3JDVTV2eGY4V090N3FaVTVEVkRza2xncwpwbVlMUnVSaXd3S0JnRnhMSHZvSW5iYkZQcHllYWova0pZTDBxcWdkV29XZHhXN3FuWHJmdDhOak5XN2xyM1EzCkVqZmsrQ0FVRzd1N0JzNUpMUDRKSXRUMVlkd0hGcTltb3NVZXFRbU83VFBoU2wva0tJVUVsWFFaUmxCbkJYeUIKQXZoVlQxbkZqUmNhNFlzYXRnQUtJN2RyK00zTTJHMHhyQytqeGxHb05nZlB3WkhxVnlwak1vdGhBb0dCQU1NLwo1ZmxNNEF2cjc3c05GeTdZNG1sQ1lyMUJzNFhDcWYxN3Z3Rk45MkZKTWtOQndDWmNxNTNzQnZPVStZQ1MwVzlBClo0UkpRNTVhMlFUYkNudng2aWUwZlgwa2ZVSnI4K2V4RGtHMTg0OGJFMlN2SkxWT2h3aEJjZ3FOSlhHNzhHQlUKcW5EWU9IN3NVM0lnVjNURjU4K2VERWFBYjIycTY2MTk5cWZNcGRiYkFvR0JBUFBFa2cvMXVRdldsZmtRd3RiSwpRV3B1WXlvNlliUWwrUktYUUJzaFpTSUZwQXJTNTRUYWNtREd6eWhRNXV0RDhQWUJkL3hDMDhYRXA4T3FTckhGCnh3MnFtd1ZWZ2hSY1FWOThTUUNiMGhqWWRaMHJxL0tEaXZxMnBJSlpEYmpxSWp0dHZrSGR3V0JWbnM3ZU5vU2IKVnV4QmhMcHNEU05qSFYzTE9MQ3k2R0UyCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
kind: Secret
metadata:
  creationTimestamp: null
  name: example-com-tls
  namespace: gateway-conformance-infra
type: kubernetes.io/tls
---
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: http3-gtw
  namespace: gateway-conformance-infra
spec:
  gatewayClassName: "{GATEWAY_CLASS_NAME}"
  listeners:
    - name: https
      protocol: HTTPS
      port: 443
      tls:
        mode: Terminate
        certificateRefs:
          - kind: Secret
            group: ""
            name: example-com-tls
---
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: ClientTrafficPolicy
metadata:
  name: http3-ctp
  namespace: gateway-conformance-infra
spec:
  http3: {}
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: Gateway
      name: http3-gtw
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: http3-route
  namespace: gateway-conformance-infra
spec:
  parentRefs:
    - name: http3-gtw
  rules:
    - backendRefs:
        - group: ""
          kind: Service
          name: infra-backend-v1
          port: 8080
          weight: 1
      matches:
        - path:
            type: PathPrefix
            value: /
